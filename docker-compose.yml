x-meltano-image: &meltano-image
  image: meltano/meltano
  working_dir: /project
  volumes:
    - .:/project
  env_file:
    - .env

services:
  meltano-install:
    <<: *meltano-image
    command: install

  meltano-run-api-extract:
    <<: *meltano-image
    command: run extraction_api
    depends_on:
      meltano-install:
        condition: service_completed_successfully

  meltano-run-db-extract:
    <<: *meltano-image
    command: run extraction_db
    depends_on:
      meltano-install:
        condition: service_completed_successfully
